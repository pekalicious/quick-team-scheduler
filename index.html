<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Schedule Grid</title>
    <style>
        .container {
            display: flex;
        }
        .schedule {
            display: grid;
            grid-template-columns: 100px repeat(7, 100px);
            grid-template-rows: 40px repeat(16, 30px);
            gap: 1px;
            text-align: center;
            user-select: none; /* Prevent text selection */
        }
        .header, .time-label, .cell {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #eee;
        }
        .header {
            font-weight: bold;
            background-color: #ddd;
        }
        .cell {
            cursor: pointer;
            border-bottom: 1px solid #ccc;
            border-right: 1px solid #ccc;
        }
        .time-label {
            border-bottom: 1px solid #ccc;
        }
        .sidebar {
            margin-left: 20px;
            display: flex;
            flex-direction: column;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="schedule" id="schedule"></div>
        <div class="sidebar" id="sidebar"></div>
    </div>
    <script>
        const schedule = document.getElementById("schedule");
        const sidebar = document.getElementById("sidebar");
        let isMouseDown = false;
        let eraseMode = false;
        let startCell = null;
        const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
        const people = ["All", ...Array.from({ length: 10 }, (_, i) => `Person ${i + 1}`)];
        let activePerson = "Person 1";
        let personData = JSON.parse(localStorage.getItem("personData")) || {};
        
        people.forEach(person => {
            if (!personData[person]) personData[person] = {};
        });

        sidebar.innerHTML = people.map(person => `
            <label>
                <input type="radio" name="person" value="${person}" ${person === activePerson ? "checked" : ""}>
                ${person}
            </label>
        `).join("<br>");

        schedule.appendChild(document.createElement("div")); // Empty top-left cell
        days.forEach(day => {
            let dayHeader = document.createElement("div");
            dayHeader.classList.add("header");
            dayHeader.textContent = day;
            schedule.appendChild(dayHeader);
        });

        const cells = [];
        for (let hour = 8; hour < 24; hour++) {
            let timeLabel = document.createElement("div");
            timeLabel.classList.add("time-label");
            timeLabel.textContent = `${hour}:00`;
            schedule.appendChild(timeLabel);
            
            for (let day = 0; day < 7; day++) {
                let cell = document.createElement("div");
                cell.classList.add("cell");
                let key = `${day}-${hour}`;
                cells.push({ cell, key, day, hour });
                
                cell.addEventListener("mousedown", (e) => {
                    if (activePerson === "All") return;
                    isMouseDown = true;
                    eraseMode = personData[activePerson][key] === "blue";
                    startCell = { day, hour };
                    updateRectangle(startCell, startCell);
                });
                
                cell.addEventListener("mouseover", (e) => {
                    if (isMouseDown && activePerson !== "All") {
                        updateRectangle(startCell, { day, hour });
                    }
                });
                
                schedule.appendChild(cell);
            }
        }

        document.addEventListener("mouseup", () => {
            isMouseDown = false;
            localStorage.setItem("personData", JSON.stringify(personData));
        });

        document.querySelectorAll('input[name="person"]').forEach(input => {
            input.addEventListener("change", (e) => {
                activePerson = e.target.value;
                updateGrid();
            });
        });

        function updateRectangle(start, end) {
            let minDay = Math.min(start.day, end.day);
            let maxDay = Math.max(start.day, end.day);
            let minHour = Math.min(start.hour, end.hour);
            let maxHour = Math.max(start.hour, end.hour);

            cells.forEach(({ cell, day, hour, key }) => {
                if (day >= minDay && day <= maxDay && hour >= minHour && hour <= maxHour) {
                    cell.style.backgroundColor = eraseMode ? "#eee" : "blue";
                    personData[activePerson][key] = eraseMode ? "#eee" : "blue";
                }
            });
        }

        function updateGrid() {
            cells.forEach(({ cell, key }) => {
                if (activePerson === "All") {
                    let count = people.slice(1).reduce((sum, person) => sum + (personData[person][key] === "blue" ? 1 : 0), 0);
                    cell.style.backgroundColor = count > 0 ? `rgba(0, 0, 255, ${0.05 * count})` : "#eee";
                } else {
                    cell.style.backgroundColor = personData[activePerson][key] || "#eee";
                }
            });
        }

        updateGrid();
    </script>
</body>
</html>
